if(typeof Protoplasm=="undefined"){throw ("protoplasm.js not loaded, could not intitialize rte")}if(typeof Control=="undefined"){Control={}}Protoplasm.use("colorpicker");Protoplasm.use("filechooser");Protoplasm.loadStylesheet("rte.css","rte");Control.RTE=Class.create();Object.extend(Control.RTE,{activeEditor:null,useEffects:false,dialogElement:null,includePath:null,initialized:false,editors:{},init:function(){if(!Control.RTE.initialized){Control.RTE.Dialog.cache={ColorPalette:new Control.RTE.Dialog.ColorPalette(),InsertLink:new Control.RTE.Dialog.InsertLink(),ImageBrowser:new Control.RTE.Dialog.ImageBrowser(),InsertTable:new Control.RTE.Dialog.InsertTable()}}},createElement:function(d,a,c,f){var b=null;try{b=document.createElement(d);if(a){for(att in a){b.setAttribute(att,a[att])}}if(c){b.className=c}if(f){Element.setStyle(b,f)}}catch(g){alert("Could not create element.")}return b}});Control.RTE.prototype={initialize:function(a,b){if(!Control.RTE.initialized){Control.RTE.init()}this.textarea=$(a);if(ta=this.textarea.retrieve("editor")){ta.destroy()}this.options=b||{};if(this.options.includePath){if(!/\/$/.test(this.options.includePath)){this.options.includePath+="/"}Control.RTE.includePath=this.options.includePath||""}else{Control.RTE.includePath=Protoplasm.base("rte")+"images/"}this.toolbarStyle=this.options.toolbarStyle;this.useXHTML=this.options.useXHTML;this.fileLister=this.options.fileLister;this.editorCss=this.options.editorCss;this.disableSourceView=this.options.disableSourceView;this.editorDiv=null;this.toolbar=null;this.iframe=null;this.iframeDiv=null;this.isEnabled=false;this.sourceCheckbox=null;this.inSourceView=false;this.activeDialog=null;this.selectedRange=null;this.keyPressListener=this.keyPressHandler.bindAsEventListener(this);this.cancelKeyPressListener=this.cancelKeyPressHandler.bindAsEventListener(this);this.keyUpListener=this.keyUpHandler.bindAsEventListener(this);this.clickListener=this.updateToolbarState.bindAsEventListener(this);this.closeDialogListener=this.closeDialog.bindAsEventListener(this);this.escKeyListener=this.escKeyPressed.bindAsEventListener(this);this.iframeTabListener=this.tabKeyPressed.bindAsEventListener(this);this.focusListener=this.focus.bindAsEventListener(this);this.changeListener=this.syncToEditor.bindAsEventListener(this);this.submitListener=function(d){this.syncToTextarea();return true}.bindAsEventListener(this);var c=navigator.userAgent.toLowerCase();this.isIE=((c.indexOf("msie")!=-1)&&(c.indexOf("opera")==-1)&&(c.indexOf("webtv")==-1));this.isGecko=(c.indexOf("gecko")!=-1);this.createEditor();this.destructor=Event.on(window,"unload",this.destroy.bind(this))},createEditor:function(){var b=this.textarea.parentNode;var c=this.textarea.offsetWidth?this.textarea.offsetWidth+"px":this.textarea.style.width;var l=this.textarea.offsetHeight?this.textarea.offsetHeight+"px":this.textarea.style.height;var g=document.createElement("div");if(c){g.style.width=c}this.toolbar=new Control.RTE.Toolbar(this,this.toolbarStyle);if(this.options.variables){this.toolbar.add(new Control.RTE.ToolbarLineBreak());this.toolbar.add(new Control.RTE.ToolbarVariableList("varlist",this.options.variables,"Insert Field",this.options.variableClass))}var h=document.createElement("div");h.className="rteEditor";this.iframeDiv=h;var k=document.createElement("div");k.style.borderTop="1px solid #999999";if(!this.disableSourceView){k.className="rteFooter";var f=document.createElement("input");f.type="checkbox";f.id=this.textarea.name+"_viewsource";f.onclick=this.toggleSourceView.bindAsEventListener(this);this.sourceCheckbox=f;k.appendChild(f);var j=document.createElement("label");j.htmlFor=f.id;j.innerHTML="View HTML Source - ";k.appendChild(j);clearFormatting=document.createElement("span");clearFormatting.onclick=function(i){if(confirm("Are you sure you want to clear all text formatting?")){this.clearFormatting()}return false}.bindAsEventListener(this);clearFormatting.innerHTML="Clear All Formatting";clearFormatting.style.textDecoration="underline";clearFormatting.style.color="blue";clearFormatting.style.cursor="pointer";k.appendChild(clearFormatting)}g.appendChild(this.toolbar.element);g.appendChild(h);g.appendChild(k);this.editorDiv=g;Element.hide(this.textarea);b.insertBefore(g,this.textarea);var d=document.createElement("iframe");d.width="100%";if(l){if(g.offsetHeight>0){d.height=parseInt(l)-g.offsetHeight}else{d.height=parseInt(l)-83}}d.style.border=0;d.style.margin=0;this.iframe=d;h.appendChild(d);this.createEditDoc();Event.observe(this.getIframeWindow().document,"click",this.closeDialogListener);Event.observe(document,"keypress",this.escKeyListener);Control.RTE.activeEditor=this;if(document.all){this.iframe.tabIndex=this.textarea.tabIndex}else{var e;var a=this.textarea.form.elements;for(e=0;e<a.length;++e){if(a[e]==this.textarea){break}if(!a[e].hidden){this.prevElement=a[e]}}if(a.length>e+1){this.nextElement=a[e+1]}if(this.prevElement){Event.observe(this.prevElement,"keypress",function(i){if(i.keyCode==Event.KEY_TAB&&!i.shiftKey){this.focus();return false}}.bindAsEventListener(this))}if(this.nextElement){Event.observe(this.nextElement,"keypress",function(i){if(i.keyCode==Event.KEY_TAB&&i.shiftKey){this.focus();return false}}.bindAsEventListener(this))}Event.observe(this.getIframeWindow().document,"keypress",this.iframeTabListener,true)}Event.observe(this.textarea,"change",this.changeListener);Event.observe(this.textarea,"focus",this.focusListener);Event.observe(this.textarea.form,"submit",this.submitListener);this.textarea.store("editor",this);return true},tabKeyPressed:function(a){if(a.keyCode==Event.KEY_TAB){this.moveFocus(a.shiftKey?this.prevElement:this.nextElement);Event.stop(a)}},focus:function(a){this.textarea.blur();this.getIframeWindow().focus()},moveFocus:function(a){if(a){if(a.editor){a.editor.focus.bind(a.editor)()}else{a.focus()}}},destroy:function(){Event.stopObserving(document,"keypress",this.escKeyListener);Event.stopObserving(this.textarea.form,"submit",this.submitListener);Event.stopObserving(this.textarea,"change",this.changeListener);Event.stopObserving(this.textarea,"focus",this.focusListener);var a=this.getIframeWindow().document;Event.stopObserving(a,"keypress",this.iframeTabListener,true);Event.stopObserving(a,"click",this.closeDialogListener);Event.stopObserving(a,"keypress",this.keyPressListener,true);Event.stopObserving(a,"keyup",this.keyUpListener,true);Event.stopObserving(a,"click",this.clickListener,true);Element.remove(this.editorDiv);this.editorDiv=null;this.iframe=null;this.sourceCheckbox=null;this.destructor.stop();this.textarea.store("editor",null);Element.show(this.textarea)},enable:function(){if(!this.isEnabled){try{var b=this.iframe.contentWindow.document;b.designMode="On";this.toolbar.enable();this.updateToolbarState();Event.stopObserving(b,"keypress",this.cancelKeyPressListener,true);Event.observe(b,"keypress",this.keyPressListener,true);Event.observe(b,"keyup",this.keyUpListener,true);Event.observe(b,"click",this.clickListener,true);if(this.sourceCheckbox){this.sourceCheckbox.disabled=false}this.isEnabled=true}catch(a){if(this.isGecko){setTimeout(this.enable.bind(this),10)}return false}}},disable:function(){if(this.isEnabled){var a=this.iframe.contentWindow.document;a.designMode="Off";this.toolbar.disable();Event.stopObserving(a,"keypress",this.keyPressListener,true);Event.stopObserving(a,"keyup",this.keyUpListener,true);Event.stopObserving(a,"click",this.clickListener,true);Event.observe(a,"keypress",this.cancelKeyPressListener,true);if(this.sourceCheckbox){this.sourceCheckbox.disabled=true}this.isEnabled=false}},createEditDoc:function(){var a=this.iframe.contentWindow.document;a.open();a.write(this.getEditorDoc(this.markupVariables(this.textarea.value),this.editorCss));a.close();this.enable()},updateToolbarState:function(){this.toolbar.refresh()},clearSelection:function(){var b=this.getIframeWindow();if(document.all){var a=b.document.selection;a.empty()}else{var a=b.getSelection();a.removeAllRanges()}this.selectedRange=null},getSelectedText:function(){if(this.selectedRange){if(this.isIE){return new String(this.selectedRange.htmlText).stripTags()}else{return this.selectedRange.toString().stripTags()}}return""},closeDialog:function(a){Control.RTE.Dialog.destroyActive()},showDialog:function(b,d){if(this.activeDialog==b){Control.RTE.Dialog.closeActive();return}var c=this.getIframeWindow();if(document.all){var a=c.document.selection;if(a){this.selectedRange=a.createRange()}}else{var a=c.getSelection();if(a&&a.rangeCount>0){this.selectedRange=a.getRangeAt(a.rangeCount-1).cloneRange()}}switch(b){case"textcolor":case"bgcolor":Control.RTE.Dialog.activate("ColorPalette",this,Event.element(d));break;case"link":Control.RTE.Dialog.activate("InsertLink",this,Event.element(d));break;case"image":Control.RTE.Dialog.activate("ImageBrowser",this,null,{fileLister:this.fileLister});break;case"table":Control.RTE.Dialog.activate("InsertTable",this,Event.element(d));break;default:new Control.RTE.Dialog(this,Event.element(d))}Control.RTE.activeEditor=this;this.activeDialog=b},setDialogColor:function(a){if(document.all&&this.selectedRange){this.selectedRange.select()}if(this.activeDialog=="textcolor"){this.doCommand("forecolor",a)}else{if(document.all){this.doCommand("backcolor",a)}else{this.doCommand("hilitecolor",a)}}setTimeout(Control.RTE.Dialog.closeActive)},insertHtml:function(a){var b=this.getIframeWindow();b.focus();if(document.all){if(this.selectedRange){this.selectedRange.pasteHTML(a);this.selectedRange.collapse(false);this.selectedRange.select()}else{}}else{b.document.execCommand("insertHTML",false,a)}setTimeout(Control.RTE.Dialog.closeActive)},getIframeWindow:function(){return this.iframe.contentWindow},doCommand:function(d,b){clearTimeout(this.syncTimeout);var a=this.getIframeWindow();try{a.focus();a.document.execCommand(d,false,b);a.focus()}catch(c){return false}this.updateToolbarState();this.syncTimeout=setTimeout(this.syncToTextarea.bind(this),1000);return true},debug:function(b){if(!this.debugElement){var a=document.createElement("div");a.style.position="absolute";a.style.top=0;a.style.width="100%";a.style.backgroundColor="#FFFFCC";a.style.MozOpacity=".8";a.style.height="125px";a.style.overflow="auto";a.style.fontFamily="monospace";a.style.borderBottom="1px solid black";this.debugElement=a;document.body.appendChild(this.debugElement);window.onscroll=function(){a.style.top=window.pageYOffset+"px"}}this.debugElement.appendChild(document.createTextNode(b));this.debugElement.appendChild(document.createElement("br"));if(this.debugElement.scrollHeight>125){this.debugElement.scrollTop=this.debugElement.scrollHeight-125}},checkCommand:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandState(c)}catch(b){return false}},checkCommandValue:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandValue(c)}catch(b){return false}},commandEnabled:function(c){var a=this.getIframeWindow();try{return a.document.queryCommandEnabled(c)}catch(b){return false}},getEditorDoc:function(b,c){var a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n';a+="<html>\n";a+="<head>\n";if(c){a+='<link media="all" type="text/css" href="'+c+'" rel="stylesheet">\n'}else{a+='<style type="text/css">\n';a+="body {\n";a+="	background: #FFFFFF;\n";a+="	margin: 2px;\n";a+="	padding: 2px;\n";a+="	font-family: sans-serif;\n";a+="	font-size: 10pt;\n";a+="}\n";a+="</style>\n"}a+='<style type="text/css">\n';a+="body.source {\n";a+="  white-space: pre;\n";a+="  font-family: monospace;\n";a+="  background-color: #FFFFDD;\n";a+="}\n";a+="</style>\n";a+="</head>\n";a+="<body>\n";a+=b+"\n";a+="</body>\n";a+="</html>";return a},toggleSourceView:function(d){var a=this.sourceCheckbox.checked;var c=this.getIframeWindow();var b=c.document;this.syncToTextarea();if(a&&!this.inSourceView){this.inSourceView=true;this.toolbar.disable();if(this.isGecko){b.body.className="source"}this.syncToEditor()}else{if(!a&&this.inSourceView){this.inSourceView=false;if(this.isGecko){b.body.className=""}if(this.isEnabled){this.toolbar.enable()}this.syncToEditor()}}c.focus()},escKeyPressed:function(a){if(a.keyCode==Event.KEY_ESC){Control.RTE.Dialog.destroyActive()}},keyPressHandler:function(b){if(this.isGecko&&b.ctrlKey){var a=String.fromCharCode(b.charCode).toLowerCase();var c=null;switch(a){case"b":c="bold";break;case"i":c="italic";break;case"u":c="underline";break}if(c){this.doCommand(c,false,null);this.updateToolbarState();Event.stop(b)}}},cancelKeyPressHandler:function(a){Event.stop(a)},keyUpHandler:function(a){clearTimeout(this.syncTimeout);if(a.keyCode==Event.KEY_DOWN||a.keyCode==Event.KEY_UP||a.keyCode==Event.KEY_LEFT||a.keyCode==Event.KEY_RIGHT||a.keyCode==Event.KEY_RETURN||a.keyCode==33||a.keyCode==34||a.keyCode==35||a.keyCode==36){this.updateToolbarState()}this.syncTimeout=setTimeout(this.syncToTextarea.bind(this),1000)},markupVariables:function(b){if(this.options.variableClass&&this.options.variableExpression){var a=new RegExp("("+this.options.variableExpression+")","gm");b=b.replace(a,'<span class="'+this.options.variableClass+'">$1</span>')}return b},unmarkupVariables:function(b){if(this.options.variableClass){var a=new RegExp('<span class="'+this.options.variableClass+'">([^<]*)</span>',"gm");b=b.replace(a,"$1")}return b},setText:function(a){this.textarea.value=a;this.syncToEditor()},getText:function(){if(this.isEnabled){this.syncToTextarea()}return this.textarea.value},syncToTextarea:function(){clearTimeout(this.syncTimeout);var a=this.getNodeText(this.getIframeWindow().document.body,!this.inSourceView);a=this.unmarkupVariables(a);this.textarea.value=this.trimWhitespace(this.escapeText(a))},getNodeText:function(b,c){var e;if(!c){if(document.all){e=escape(b.innerText);e=e.replace("%3CP%3E%0D%0A%3CHR%3E","%3CHR%3E");e=unescape(e.replace("%3CHR%3E%0D%0A%3C/P%3E","%3CHR%3E"))}else{var d=b.ownerDocument.createRange();d.selectNodeContents(b);e=d.toString()}if(this.useXHTML){var a=document.createElement("div");a.innerHTML=e;e=get_xhtml(a)}}else{if(this.useXHTML){e=get_xhtml(b)}else{e=b.innerHTML}}return e},escapeText:function(b){for(var a=0;a<b.length;++a){var c=b.charCodeAt(a);if(c==13){b=b.substring(0,a).concat(b.substring(a+1,b.length))}else{if(c>128){if(c==39||c==145||c==146||c==8217||c==8216){b=b.substring(0,a).concat("&apos;",b.substring(a+1,b.length))}else{if(c==34||c==147||c==148||c==8220||c==8221){b=b.substring(0,a).concat("&quot;",b.substring(a+1,b.length))}else{if(c==150||c==8211){b=b.substring(0,a).concat("-",b.substring(a+1,b.length))}else{if(c==153||c==8482){b=b.substring(0,a).concat("&trade;",b.substring(a+1,b.length))}else{b=b.substring(0,a).concat("&#",String(c),";",b.substring(a+1,b.length))}}}}}}}return b},trimWhitespace:function(d){var f=0;var a=-1;for(var b=0;b<d.length;++b){var e=d.charCodeAt(b);switch(d.charCodeAt(b)){case 32:case 8:case 10:case 13:if(a==-1){f=b+1}break;default:a=b}}if(a==-1){return""}return d.substr(f,(a+1)-f)},clearFormatting:function(){var a=document.createElement("div");a.innerHTML=this.getText();this.removeNodeFormatting(a);this.textarea.value=this.getNodeText(a,!this.inSourceView);this.syncToEditor()},removeNodeFormatting:function(b){if(b.childNodes.length>0){for(var a=0;a<b.childNodes.length;++a){var c=b.childNodes[a];if(c.nodeType==1){this.removeNodeFormatting(c);switch(c.nodeName.toLowerCase()){case"p":case"br":case"img":case"a":break;default:a+=c.childNodes.length-1;while(c.firstChild){b.insertBefore(c.firstChild,c)}b.removeChild(c)}}}}},syncToEditor:function(){var a=this.getIframeWindow().document;if(this.inSourceView){if(document.all){a.body.innerText=this.textarea.value}else{var b=a.createTextNode(this.textarea.value);a.body.innerHTML="";a.body.appendChild(b)}}else{a.body.innerHTML=this.markupVariables(this.textarea.value)}}};Control.RTE.Toolbar=Class.create();Object.extend(Control.RTE.Toolbar.prototype,{initialize:function(a,b){this.editor=a;this.items=[];this.element=document.createElement("div");this.element.className="rteToolbar";this.addLayout(b)},add:function(a){a.toolbar=this;this.items.push(a);this.element.appendChild(a.element)},addSeparator:function(){this.add(new Control.RTE.ToolbarSeparator())},addLineBreak:function(){this.add(new Control.RTE.ToolbarLineBreak())},disable:function(){this.disabled=true;Element.addClassName(this.element,"rteToolbarDisabled");this.items.each(function(a){a.disable()})},enable:function(){this.disabled=false;Element.removeClassName(this.element,"rteToolbarDisabled");this.items.each(function(a){a.enable()})},refresh:function(){if(!this.toolbarRefreshing){this.toolbarRefreshing=true;this.items.each(function(a){a.refresh()});if(this.toolbarNeedsRefresh){this.refresh()}this.toolbarRefreshing=false;this.toolbarNeedsRefresh=false}else{this.toolbarNeedsRefresh=true}},addLayout:function(a){if(a=="simple"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO())}else{if(a=="html"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE())}else{if(a=="advanced"){this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.LEFT_JUSTIFY());this.add(Control.RTE.ToolbarButton.CENTER_JUSTIFY());this.add(Control.RTE.ToolbarButton.RIGHT_JUSTIFY());this.add(Control.RTE.ToolbarButton.FULL_JUSTIFY());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.HORIZONTAL_RULE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.ORDERED_LIST());this.add(Control.RTE.ToolbarButton.UNORDERED_LIST());this.add(Control.RTE.ToolbarButton.OUTDENT());this.add(Control.RTE.ToolbarButton.INDENT());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE());this.add(Control.RTE.ToolbarButton.INSERT_TABLE())}else{this.add(Control.RTE.ToolbarButton.FONT_FACE());this.add(Control.RTE.ToolbarButton.FONT_SIZE());this.add(Control.RTE.ToolbarButton.BLOCK_STYLE());this.add(new Control.RTE.ToolbarLineBreak());this.add(Control.RTE.ToolbarButton.BOLD());this.add(Control.RTE.ToolbarButton.ITALIC());this.add(Control.RTE.ToolbarButton.UNDERLINE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.LEFT_JUSTIFY());this.add(Control.RTE.ToolbarButton.CENTER_JUSTIFY());this.add(Control.RTE.ToolbarButton.RIGHT_JUSTIFY());this.add(Control.RTE.ToolbarButton.FULL_JUSTIFY());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.UNDO());this.add(Control.RTE.ToolbarButton.REDO());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.HORIZONTAL_RULE());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.ORDERED_LIST());this.add(Control.RTE.ToolbarButton.UNORDERED_LIST());this.add(Control.RTE.ToolbarButton.OUTDENT());this.add(Control.RTE.ToolbarButton.INDENT());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.TEXT_COLOR());this.add(Control.RTE.ToolbarButton.BACKGROUND_COLOR());this.add(new Control.RTE.ToolbarSeparator());this.add(Control.RTE.ToolbarButton.INSERT_LINK());this.add(Control.RTE.ToolbarButton.INSERT_IMAGE());this.add(Control.RTE.ToolbarButton.INSERT_TABLE())}}}}});Control.RTE.ToolbarItem=new Object();Object.extend(Control.RTE.ToolbarItem,{element:null,toolbar:null,refresh:Prototype.emptyFunction,enable:Prototype.emptyFunction,disable:Prototype.emptyFunction});Control.RTE.ToolbarSeparator=Class.create();Object.extend(Control.RTE.ToolbarSeparator.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarSeparator.prototype,{initialize:function(){var a=document.createElement("img");a.className="rteVertSep";a.src=Control.RTE.includePath+"separator.gif";a.width=1;a.height=20;this.element=a}});Control.RTE.ToolbarLineBreak=Class.create();Object.extend(Control.RTE.ToolbarLineBreak.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarLineBreak.prototype,{initialize:function(){this.element=document.createElement("hr");this.element.className="rteHorizSep"}});Control.RTE.ToolbarButton=Class.create();Object.extend(Control.RTE.ToolbarButton.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarButton.prototype,{initialize:function(c,a,b){this.element=this.createButton(c,a,b)},createButton:function(d,b,c){var a=document.createElement("img");a.id=d;a.className="rteButton";a.src=Control.RTE.includePath+b;a.width=25;a.height=24;a.alt=c;a.title=c;this.addCommonBehavior(a);this.addButtonBehavior(a);return a},addButtonBehavior:function(a){this.addButtonActionBehavior(a)},addButtonActionBehavior:function(a,b){a.onclick=function(c){if(!this.toolbar.disabled){(b||Prototype.emptyFunction).bind(this)(c)}}.bindAsEventListener(this);a.onmousedown=function(c){if(!this.toolbar.disabled){Element.addClassName(Event.element(c),"rteButtonActive");Element.removeClassName(Event.element(c),"rteButtonHover")}return false}.bindAsEventListener(this);a.onmouseup=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonActive");Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseover=function(c){if(!this.toolbar.disabled&&!Element.hasClassName(Event.element(c),"rteButtonActive")){Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseout=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonHover")}Element.removeClassName(Event.element(c),"rteButtonActive")}.bindAsEventListener(this)},addCommonBehavior:function(a){a.onmousedown=function(){return false};a.onselectstart=function(){return false}},disable:function(){Element.setOpacity(this.element,0.3)},enable:function(){Element.setOpacity(this.element,1)}});Control.RTE.ToolbarCommandButton=Class.create();Object.extend(Control.RTE.ToolbarCommandButton.prototype,Control.RTE.ToolbarButton.prototype);Object.extend(Control.RTE.ToolbarCommandButton.prototype,{initialize:function(e,b,d,c,a){this.command=c;this.noSync=a;this.element=this.createButton(e,b,d)},addButtonBehavior:function(a){if(this.noSync){this.addButtonActionBehavior(a,function(b){return this.toolbar.editor.doCommand(this.command)}.bindAsEventListener(this))}else{this.addButtonStateBehavior(a,function(b){return this.toolbar.editor.doCommand(this.command)}.bindAsEventListener(this))}},addButtonStateBehavior:function(a,b){a.onmousedown=function(c){if(!this.toolbar.disabled&&b(c)){if(this.toolbar.editor.checkCommand(this.command)){Element.addClassName(Event.element(c),"rteButtonActive");Element.removeClassName(Event.element(c),"rteButtonHover")}else{Element.removeClassName(Event.element(c),"rteButtonActive");Element.addClassName(Event.element(c),"rteButtonHover")}}return false}.bindAsEventListener(this);a.onmouseover=function(c){if(!this.toolbar.disabled&&!Element.hasClassName(Event.element(c),"rteButtonActive")){Element.addClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this);a.onmouseout=function(c){if(!this.toolbar.disabled){Element.removeClassName(Event.element(c),"rteButtonHover")}}.bindAsEventListener(this)},refresh:function(){if(this.toolbar.editor.checkCommand(this.command)){Element.addClassName(this.element,"rteButtonActive")}else{Element.removeClassName(this.element,"rteButtonActive")}}});Control.RTE.ToolbarDialogButton=Class.create();Object.extend(Control.RTE.ToolbarDialogButton.prototype,Control.RTE.ToolbarButton.prototype);Object.extend(Control.RTE.ToolbarDialogButton.prototype,{initialize:function(d,a,c,b){this.dialogType=b;this.element=this.createButton(d,a,c)},addButtonBehavior:function(a){this.addButtonActionBehavior(a,function(b){return this.toolbar.editor.showDialog(this.dialogType,b)}.bindAsEventListener(this))}});Control.RTE.ToolbarCommandList=Class.create();Object.extend(Control.RTE.ToolbarCommandList.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarCommandList.prototype,{initialize:function(d,a,c,b){this.command=b;this.element=this.createList(d,a,c)},createList:function(d,b,c){var a=new Element("select",{id:d});a.appendChild(new Element("option",{value:""}).insert({top:c}));if(b.constructor==Array){b.each(function(e){a.appendChild(new Element("option",{value:e}).insert({top:e}))})}else{$H(b).each(function(e){a.appendChild(new Element("option",{value:e[0]}).insert({top:e[1]}))})}this.applyBehavior(a);return a},applyBehavior:function(a){a.onchange=this.valueChanged.bindAsEventListener(this)},valueChanged:function(c){if(!this.toolbar.disabled){var a=Event.element(c);var b=a.options[a.selectedIndex].value;this.toolbar.editor.doCommand(this.command,b)}},refresh:function(){var b=this.toolbar.editor.checkCommandValue(this.command);for(var a=0;a<this.element.options.length;++a){if(this.element.options[a].value==b){this.element.selectedIndex=a}break}},disable:function(){this.element.disabled=true},enable:function(){this.element.disabled=false}});Control.RTE.ToolbarVariableList=Class.create();Object.extend(Control.RTE.ToolbarVariableList.prototype,Control.RTE.ToolbarItem);Object.extend(Control.RTE.ToolbarVariableList.prototype,{initialize:function(d,b,c,a){this.spanClass=a;this.element=this.createList(d,b,c)},createList:function(d,b,c){var a=new Element("select",{id:d});a.appendChild(new Element("option",{value:""}).insert({top:c}));b.each(function(e){a.appendChild(new Element("option",{value:e}).insert({top:e}))});this.applyBehavior(a);return a},applyBehavior:function(a){a.onchange=this.valueChanged.bindAsEventListener(this)},valueChanged:function(c){if(!this.toolbar.disabled){var a=Event.element(c);var b=a.options[a.selectedIndex].value;if(b){if(this.spanClass){b='<span class="'+this.spanClass+'">'+b+"</span>&nbsp;"}this.toolbar.editor.insertHtml(b)}a.selectedIndex=0}},disable:function(){this.element.disabled=true},enable:function(){this.element.disabled=false}});Control.RTE.ToolbarButton.FONT_FACE=function(){return new Control.RTE.ToolbarCommandList("rteFontFace",{serif:"Serif","sans-serif":"Sans Serif",monospace:"Monospace"},"Font","fontname")};Control.RTE.ToolbarButton.FONT_SIZE=function(){return new Control.RTE.ToolbarCommandList("rteFontSize",{"1":"-1","2":"Normal","3":"+1","4":"+2","5":"+3","6":"+4","7":"+5"},"Font Size","fontsize")};Control.RTE.ToolbarButton.BLOCK_STYLE=function(){return new Control.RTE.ToolbarCommandList("rteBlockStyle",{span:"No Style",p:"Paragraph",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",address:"Address"},"Style","formatblock")};Control.RTE.ToolbarButton.BOLD=function(){return new Control.RTE.ToolbarCommandButton("rteBold","bold.gif","Bold","bold")};Control.RTE.ToolbarButton.ITALIC=function(){return new Control.RTE.ToolbarCommandButton("rteItalic","italic.gif","Italic","italic")};Control.RTE.ToolbarButton.UNDERLINE=function(){return new Control.RTE.ToolbarCommandButton("rteUnderline","underline.gif","Underline","underline")};Control.RTE.ToolbarButton.LEFT_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteLeftJustify","left_just.gif","Align Left","justifyleft")};Control.RTE.ToolbarButton.CENTER_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteCenterJustify","centre.gif","Align Center","justifycenter")};Control.RTE.ToolbarButton.RIGHT_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteRightJustify","right_just.gif","Align Right","justifyright")};Control.RTE.ToolbarButton.FULL_JUSTIFY=function(){return new Control.RTE.ToolbarCommandButton("rteFullJustify","justifyfull.gif","Full Justified","justifyfull")};Control.RTE.ToolbarButton.UNDO=function(){return new Control.RTE.ToolbarCommandButton("rteUndo","undo.gif","Undo","undo",true)};Control.RTE.ToolbarButton.REDO=function(){return new Control.RTE.ToolbarCommandButton("rteRedo","redo.gif","Redo","redo",true)};Control.RTE.ToolbarButton.HORIZONTAL_RULE=function(){return new Control.RTE.ToolbarCommandButton("rteHorizontalRule","hr.gif","Horizontal Rule","inserthorizontalrule",true)};Control.RTE.ToolbarButton.ORDERED_LIST=function(){return new Control.RTE.ToolbarCommandButton("rteOrderedList","numbered_list.gif","Ordered List","insertorderedlist")};Control.RTE.ToolbarButton.UNORDERED_LIST=function(){return new Control.RTE.ToolbarCommandButton("rteUnorderedList","list.gif","Unordered List","insertunorderedlist")};Control.RTE.ToolbarButton.OUTDENT=function(){return new Control.RTE.ToolbarCommandButton("rteOutdent","outdent.gif","Outdent","outdent",true)};Control.RTE.ToolbarButton.INDENT=function(){return new Control.RTE.ToolbarCommandButton("rteIndent","indent.gif","Indent","indent",true)};Control.RTE.ToolbarButton.TEXT_COLOR=function(){return new Control.RTE.ToolbarDialogButton("rteTextColor","textcolor.gif","Text Color","textcolor")};Control.RTE.ToolbarButton.BACKGROUND_COLOR=function(){return new Control.RTE.ToolbarDialogButton("rteBackgroundColor","bgcolor.gif","Background Color","bgcolor")};Control.RTE.ToolbarButton.INSERT_LINK=function(){return new Control.RTE.ToolbarDialogButton("rteLink","hyperlink.gif","Insert Link","link")};Control.RTE.ToolbarButton.INSERT_IMAGE=function(){return new Control.RTE.ToolbarDialogButton("rteImage","image.gif","Insert Image","image")};Control.RTE.ToolbarButton.INSERT_TABLE=function(){return new Control.RTE.ToolbarDialogButton("rteTable","insert_table.gif","Insert Table","table")};Control.RTE.Dialog=Class.create();Object.extend(Control.RTE.Dialog,{activeEffect:null,activeDialog:null,closeActive:function(){if(Control.RTE.Dialog.activeDialog){if(Control.RTE.useEffects){if(Control.RTE.Dialog.activeEffect){Control.RTE.Dialog.activeEffect.cancel()}Control.RTE.Dialog.activeEffect=new Effect.SlideUp(Control.RTE.Dialog.activeDialog.dialogContainer,{afterFinish:Control.RTE.Dialog.destroyActive,duration:0.2})}else{Control.RTE.Dialog.destroyActive()}}},destroyActive:function(){if(Control.RTE.Dialog.activeDialog){if(Control.RTE.Dialog.activeEffect){Control.RTE.Dialog.activeEffect.cancel();Control.RTE.Dialog.activeEffect=null}Control.RTE.Dialog.activeDialog.destroy();Control.RTE.Dialog.activeDialog=null}},activate:function(c,d,b,a,e){Control.RTE.Dialog.destroyActive();Control.RTE.Dialog.activeDialog=Control.RTE.Dialog.cache[c];Control.RTE.Dialog.cache[c].activate(d,b,a,e)}});Object.extend(Control.RTE.Dialog.prototype,{initialize:function(){var a=Control.RTE.createElement("div",null,null,{position:"absolute"});var b=Control.RTE.createElement("div",null,"rteDialog");b.appendChild(this.create());a.appendChild(b);Element.hide(a);this.element=a},activate:function(f,e,i,h){this.editor=f;this.callback=h;this.editor.editorDiv.appendChild(this.element);if(e){var a=Position.cumulativeOffset(e);this.element.style.top=(a[1]+e.offsetHeight)+"px";var g=Position.cumulativeOffset(f.editorDiv)[0]+f.editorDiv.offsetWidth;var c=a[0];var b=Element.getDimensions(this.element).width;if(c+b>g){c=g-b}this.element.style.left=c+"px"}else{this.element.style.top=Position.cumulativeOffset(f.iframeDiv)[1]+"px";var b=Element.getDimensions(this.element).width;var d=f.editorDiv.offsetWidth;var c=((d-b)/2)+Position.cumulativeOffset(f.editorDiv)[0];this.element.style.left=c+"px"}this.refresh(i);if(Control.RTE.useEffects){Control.RTE.Dialog.activeEffect=new Effect.SlideDown(this.element,{afterFinish:this.dialogReady.bind(this),duration:0.2})}else{Element.show(this.element);this.dialogReady()}},refresh:function(a){},destroy:function(){Element.remove(this.element);if(this.editor){this.editor.activeDialog=null}this.editor=null;this.callback=null},dialogReady:function(a){if(Control.RTE.Dialog.activeEffect==a){Control.RTE.Dialog.activeEffect=null}if(Control.RTE.Dialog.activeDialog==this){(this.focus||Prototype.emptyFunction).bind(this)();(this.callback||Prototype.emptyFunction)();this.editor.getIframeWindow().blur();window.focus()}},create:function(){return document.createElement("div")}});Control.RTE.Dialog.ColorPalette=Class.create();Object.extend(Control.RTE.Dialog.ColorPalette.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.ColorPalette.prototype,{create:function(){this.colorpicker=new Control.ColorPicker.Panel({className:"rteColorPicker",onSelect:function(a){this.editor.setDialogColor(a)}.bind(this)});return this.colorpicker.element},focus:function(){Field.activate(this.colorpicker.customInput)}});Control.RTE.Dialog.InsertLink=Class.create();Object.extend(Control.RTE.Dialog.InsertLink.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.InsertLink.prototype,{create:function(){var i=document.createElement("div");var a=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var g=a.insertRow(0);var f=g.insertCell(0);f.innerHTML="Title";f=g.insertCell(1);var h=Control.RTE.createElement("input",{id:"link_title",type:"text"},null,{width:"120px",border:"1px solid gray"});f.appendChild(h);var g=a.insertRow(1);var f=g.insertCell(0);f.innerHTML="URL";f=g.insertCell(1);var c=Control.RTE.createElement("input",{id:"link_url",type:"text"},null,{width:"120px",border:"1px solid gray"});f.appendChild(c);var g=a.insertRow(2);var f=g.insertCell(0);f.innerHTML="Tooltip";f=g.insertCell(1);f.appendChild(Control.RTE.createElement("input",{id:"link_tooltip",type:"text"},null,{width:"120px",border:"1px solid gray"}));var g=a.insertRow(3);var f=g.insertCell(0);f.innerHTML="&nbsp;";f=g.insertCell(1);f.appendChild(Control.RTE.createElement("input",{id:"link_newwindow",type:"checkbox"}));var e=Control.RTE.createElement("label",{"for":"link_newwindow"});e.innerHTML="New window";f.appendChild(e);var g=a.insertRow(4);var f=g.insertCell(0);f.colSpan=2;f.align="center";f.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));var d=Control.RTE.createElement("input",{id:"link_insert",type:"submit",value:"Insert Link"},null,{border:"1px solid gray"});f.appendChild(d);var b=Control.RTE.createElement("form",{id:"link_form"},null,{margin:"0",padding:"0"});b.onsubmit=this.submitLinkListener();b.appendChild(a);i.appendChild(b);return i},focus:function(){var a=this.editor.getSelectedText();if(a&&a!=""){$("link_title").value=a;Field.activate("link_url")}else{Field.activate("link_title")}},submitLinkListener:function(){return function(a){var b='<a href="'+$("link_url").value+'"';if($("link_newwindow").checked){b+=' target="_new"'}if($("link_tooltip").value!=""){b+=' title="'+$("link_tooltip").value+'"'}b+=">"+$("link_title").value+"</a>";this.editor.insertHtml(b);return false}.bindAsEventListener(this)}});Control.RTE.Dialog.InsertTable=Class.create();Object.extend(Control.RTE.Dialog.InsertTable.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.InsertTable.prototype,{create:function(){var c=document.createElement("div");var d=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var h=d.insertRow(0);var b=h.insertCell(0);b.innerHTML="Rows";b=h.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"table_rows",type:"text",value:"2",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));var b=h.insertCell(2);b.width=5;b.innerHTML="&nbsp;";var b=h.insertCell(3);b.innerHTML="Columns";b=h.insertCell(4);b.appendChild(Control.RTE.createElement("input",{id:"table_cols",type:"text",value:"2",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(1);b=h.insertCell(0);b.innerHTML="Width";b=h.insertCell(1);b.colSpan=4;b.appendChild(Control.RTE.createElement("input",{id:"table_width",type:"text",value:"100",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));var a=Control.RTE.createElement("select",{id:"table_width_type"},null,{border:"1px solid gray",marginLeft:"3px"});var f=Control.RTE.createElement("option",{value:"px"});f.innerHTML="pixels";a.appendChild(f);f=Control.RTE.createElement("option",{value:"%"});f.innerHTML="percent";f.selected=true;a.appendChild(f);b.appendChild(a);h=d.insertRow(2);b=h.insertCell(0);b.colSpan=5;b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));h=d.insertRow(3);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Border width";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_border",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(4);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Cell spacing";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_cellspacing",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(5);b=h.insertCell(0);b.colSpan=3;b.innerHTML="Cell padding";b=h.insertCell(1);b.colSpan=2;b.appendChild(Control.RTE.createElement("input",{id:"table_cellpadding",type:"text",value:"1",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));h=d.insertRow(6);b=h.insertCell(0);b.colSpan=5;b.align="center";b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));var g=Control.RTE.createElement("input",{id:"table_insert",type:"submit",value:"Insert Table"},null,{border:"1px solid gray"});b.appendChild(g);var e=Control.RTE.createElement("form",{id:"table_form"},null,{margin:"0",padding:"0"});e.onsubmit=this.submitTableListener();e.appendChild(d);c.appendChild(e);return c},submitTableListener:function(){return function(h){var b='<table border="'+$("table_border").value+'"';b+=' cellspacing="'+$("table_cellspacing").value+'"';b+=' cellpadding="'+$("table_cellpadding").value+'"';var d=$("table_width").value+$("table_width_type").options[$("table_width_type").selectedIndex].value;b+=' width="'+d+'">';var f=parseInt($("table_rows").value);var g=parseInt($("table_cols").value);for(var c=0;c<f;++c){b+="<tr>";for(var a=0;a<f;++a){b+="<td>&nbsp;</td>"}b+="</tr>"}b+="</table>";this.editor.insertHtml(b);return false}.bindAsEventListener(this)},focus:function(){$("table_rows").focus();$("table_rows").select()}});Control.RTE.Dialog.ImageBrowser=Class.create();Object.extend(Control.RTE.Dialog.ImageBrowser.prototype,Control.RTE.Dialog.prototype);Object.extend(Control.RTE.Dialog.ImageBrowser.prototype,{create:function(){var a=document.createElement("div");this.imageForm=this.createAttributeForm();a.appendChild(this.imageForm);return a},refresh:function(a){this.imageForm.reset();if(a&&a.fileLister&&typeof Control.FileChooser!="undefined"){if(!this.browser){this.browser=new Control.FileChooser.Panel(null,{className:"rteFileChooser",fileImage:Control.RTE.includePath+"/file.gif",directoryImage:Control.RTE.includePath+"/directory.gif",parentImage:Control.RTE.includePath+"/parent.gif",selectListener:function(b){$("image_url").value=b},previewListener:function(c,b){$("image_width").value=c;$("image_height").value=b},openListener:this.submitImageListener()});this.imageForm.parentNode.insertBefore(this.browser.getElement(),this.imageForm)}this.browser.fileLister=a.fileLister;this.browser.refresh(null)}},createAttributeForm:function(){var g=Control.RTE.createElement("form",{id:"image_form"},null,{margin:"0",padding:"0"});g.onsubmit=this.submitImageListener();var c=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});var f=c.insertRow(0);var b=f.insertCell(0);b.innerHTML="<nobr>Image URL</nobr>";b=f.insertCell(1);b.colSpan=7;b.appendChild(Control.RTE.createElement("input",{id:"image_url",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(1);b=f.insertCell(0);b.innerHTML="Width";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_width",type:"text",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));b=f.insertCell(2);b.width=5;b.innerHTML="&nbsp;";b=f.insertCell(3);b.innerHTML="Height";b=f.insertCell(4);b.align="right";b.appendChild(Control.RTE.createElement("input",{id:"image_height",type:"text",align:"right"},null,{width:"30px",border:"1px solid gray",paddingRight:"3px"}));b=f.insertCell(5);b.width=5;b.innerHTML="&nbsp;";b=f.insertCell(6);b.innerHTML="Alignment";b=f.insertCell(7);var a=Control.RTE.createElement("select",{id:"image_align"},null,{border:"1px solid gray"});var d=Control.RTE.createElement("option",{value:""});d.innerHTML="Default";d.selected=true;a.appendChild(d);d=Control.RTE.createElement("option",{value:"left"});d.innerHTML="Left";a.appendChild(d);d=Control.RTE.createElement("option",{value:"center"});d.innerHTML="Center";a.appendChild(d);d=Control.RTE.createElement("option",{value:"right"});d.innerHTML="Right";a.appendChild(d);b.appendChild(a);g.appendChild(c);c=Control.RTE.createElement("table",{cellpadding:2,cellspacing:0,border:0});f=c.insertRow(0);b=f.insertCell(0);b.innerHTML="Description";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_title",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(1);b=f.insertCell(0);b.innerHTML="Alt text";b=f.insertCell(1);b.appendChild(Control.RTE.createElement("input",{id:"image_alt",type:"text"},null,{width:"295px",border:"1px solid gray"}));f=c.insertRow(2);b=f.insertCell(0);b.colSpan=2;b.appendChild(Control.RTE.createElement("hr",null,"rteHorizSep"));g.appendChild(c);var e=Control.RTE.createElement("div",null,null,{textAlign:"center"});e.appendChild(Control.RTE.createElement("input",{id:"image_insert",type:"submit",value:"Insert Image"},null,{border:"1px solid gray"}));g.appendChild(e);return g},createImageHtml:function(b,c,a,g,f,e){var d='<img src="'+b+'"';if(c&&c!=""){d+=' width="'+c+'"'}if(a&&a!=""){d+=' height="'+a+'"'}if(g&&g!=""){d+=' align="'+g+'"'}if(f&&f!=""){d+=' title="'+f+'"'}if(e&&e!=""){d+=' alt="'+e+'"'}d+=' border="0"/>';return d},submitImageListener:function(){return function(f){var b=$("image_url").value;var c=$("image_width").value;var a=$("image_height").value;var h=$("image_align").options[$("image_align").selectedIndex].value;var g=$("image_title").value;var d=$("image_alt").value;this.editor.insertHtml(this.createImageHtml(b,c,a,h,g,d));return false}.bindAsEventListener(this)}});Protoplasm.register("rte",Control.RTE);